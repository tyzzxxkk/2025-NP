<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파이어베이스 CRUD</title>
</head>

<body>
    <h1>파이어베이스 CRUD</h1>

    <form id="addForm">
        <input type="text" id="itemInput" placeholder="입력해주세요">
        <button type="submit">추가</button>
    </form>
    <ul id="items"></ul>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
        import { getFirestore, doc, setDoc, collection, getDocs, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyD-SyQggjB_ZxzWs8VH0Fv6gyXHUt9ZshI",
            authDomain: "np22-e473e.firebaseapp.com",
            projectId: "np22-e473e",
            storageBucket: "np22-e473e.firebasestorage.app",
            messagingSenderId: "396319880052",
            appId: "1:396319880052:web:1af0353f26d363dfcb3221",
            measurementId: "G-VX77XCVFD2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);


        // Initialize Cloud Firestore and get a reference to the service
        const db = getFirestore(app);

        // Add a new document in collection "cities"
        await setDoc(doc(db, "cities", "LA"), {
            name: "Los Angeles",
            state: "CA",
            country: "USA"
        });

        await setDoc(doc(db, "cities", "LA2"), {
            name: "Los Angeles",
            state: "CA",
            country: "USA"
        });

        await setDoc(doc(db, "cities", "LA3"), {
            name: "Los Angeles",
            state: "CA",
            country: "USA"
        });

        // create
        const addForm = document.getElementById("addForm");
        const itemInput = document.getElementById("itemInput");
        const items = document.getElementById("items") // ul
        const itemsCol = collection(db, "items");

        addForm.addEventListener("submit", async (event) => {
            event.preventDefault(); // 이벤트 막기
            const value = itemInput.value.trim();
            console.log("인풋값 : ", itemInput.value)
            if (value) {
                await addDoc(itemsCol, {
                    text: value
                });
                itemInput.value = "";
                renderItems();
            } else {
                alert("값 넣던가 안 추가 할거임")
            }
        })

        // Read
        async function renderItems() {
            items.innerHTML = "";
            const getItems = await getDocs(itemsCol);
            getItems.forEach((item) => {
                const li = document.createElement("li")
                li.innerText = item.data().text;

                const deleteButton = document.createElement("button");
                deleteButton.innerText = "삭제";
                li.appendChild(deleteButton);
                deleteButton.onclick = async () => {
                    const docRef = doc(db, "items", item.id);
                    await deleteDoc(docRef);
                    renderItems();
                }

                // deleteButton.addEventListener("click", async () => {
                //     await deleteDoc(doc(db, "items", item.id));
                //     renderItems();
                // });

                const editButton = document.createElement("button");
                editButton.innerText = "수정";
                li.appendChild(editButton);
                items.appendChild(li);
                editButton.onclick = async () => {
                    const newText = prompt("수정할 값을 입력해주세요 : ", "예시");
                    const docRef = doc(db, "items", item.id);
                    await updateDoc(docRef, { text: newText });
                    renderItems();
                }
            });
        }
        renderItems();
    </script>
</body>

</html>